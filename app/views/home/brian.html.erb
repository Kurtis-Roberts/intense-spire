<% info = get_stats("too") %>
<% character_races = {0 => "Titan", 1 => "Hunter", 2 => "Warlock"} %>
<% weapons = {"Auto Rifle" => "auto-rifle.png", 
              "Pulse Rifle" => "pulse-rifle.png", 
              "Hand Cannon" => "hand-cannon.png",
              "Sniper Rifle" => "sniper.png",
              "Shotgun" => "shotgun.png",
              "Scout Rifle" => "pulse-rifle.png",
        } %>
<% stuff = {"testing" => "abc", "hello_there" => "hi!"} %>


<div class="container" style="width: 85%">

        <%= react_component 'AdminPanel', { chartData: info }  %>
        <%= react_component 'Hello' %>
        <%= react_component 'TestingClass' %>
        <%= react_component 'Navigation' %>            


    <%= react_component 'Testing', { firstName: current_user.display_name } %>
    <div id="testing"></div>
    
    <h2 class="tooltip" title="This is my span's tooltip message!">Tooltip test</h2>
    <span class="tooltip" data-tooltip-content="#tooltip_content">This span has a tooltip with HTML when you hover over it!</span>
    
    <div id="kd-slider"></div><br><br>
    <div id="elo-slider"></div>

    
    </div>
    

<h4 class="center">PLAYER STATS</h4>
<a id="expand-button" class="waves-effect waves-light btn" onClick="expandAll();"><i class="material-icons left">fullscreen</i>Open All</a>
<a id="collapse-button" class="waves-effect waves-light btn" onClick="collapseAll();"><i class="material-icons left">fullscreen_exit</i>Close All</a>
<hr>
<!-- <div class="row" style="margin-left: -8%; margin-right: -8%">     -->
<div class="row">      
    <div class="col s12" >
        <div id="stat-graphs"> 
            <ul id="test-collapse" class="collapsible popout" data-collapsible="expandable">
                <% info.each_with_index do |character, index| %>
                    <div class="tooltip_templates">                                                      
                        <span id="diamond_elo_content">
                            <div class="row center-align">
                                Diamond Tier
                            </div>
                            <div class="row center-align">
                                # <%= character["character_stats"]['ELO']['Rank'] %>
                            </div>
                        </span>
                        <span id="platinum_elo_content">
                            <div class="row center-align">
                                Platinum Tier
                            </div>
                            <div class="row center-align">
                                # <%= character["character_stats"]['ELO']['Rank'] %>
                            </div>
                        </span>
                        <span id="gold_elo_content">
                            <div class="row center-align">
                                Gold Tier
                            </div>
                            <div class="row center-align">
                                # <%= character["character_stats"]['ELO']['Rank'] %>
                            </div>
                        </span>
                        <span id="silver_elo_content">
                            <div class="row center-align">
                                Silver Tier
                            </div>
                            <div class="row center-align">
                                # <%= character["character_stats"]['ELO']['Rank'] %>
                            </div>
                        </span>
                        <span id="bronze_elo_content">
                            <div class="row center-align">
                                Bronze Tier
                            </div>
                            <div class="row center-align">
                                # <%= character["character_stats"]['ELO']['Rank'] %>
                            </div>
                        </span>
                    </div>
                    <li>
                        <% x = character %>
                        <% case x["Character Items"]["Subclass"]["Item Name"] 
                            when "Nightstalker", "Voidwalker", "Defender" %>
                            <% subclass =  "height: 20px; position: relative; bottom: 20px; background-image: url(#{image_path "void.png"}); background-size: cover;background-position-y: -50px;" %>
                            <% text_color =  "color: #f5f5f5; font-size: 14px; text-shadow: none;" %>
                        <% when "Sunsinger", "Gunslinger", "Sunbreaker" %>
                            <% subclass =  "height: 20px; position: relative; bottom: 20px;background-image: url(#{image_path "solar.png"}); background-size: cover;background-position-y: -50px;" %>
                            <% text_color =  "color: #3a3a3a; font-size: 14px;" %>
                        <%  when "Bladedancer", "Striker", "Stormcaller" %>
                            <% subclass =  "height: 20px; position: relative; bottom: 20px; background-image: url(#{image_path "arc.png"}); background-size: cover;background-position-y: -50px;" %>
                            <% text_color =  "color: #3a3a3a; font-size: 14px;" %>
                        <% end %>
                        <div class="collapsible-header" id="collapse-header" style="height: 104px; padding: 0;">
                            <div class="row" style="margin-right: 0; margin-left: 0; width: 100%;">
                                <div class="col s12 m4">
                                    <% bg = "background-image: url(#{x['Character Items']['emblem_background']});" %>
                                    <div class="post-header" style='<%= "#{bg} margin: -3.3%; height: 83px; margin-top: 0;" %>'>                            
                                        <div class="row" style="overflow: hidden; max-height: 65px; margin-right: 0;">
                                            <div class="col s3 left-align" style="padding: 0; height: 65px;">
                                                <%= image_tag x["Character Items"]["emblem"]["Item Icon"], style:"max-width: calc(100% - 2.6em); min-width: 65px; position: relative; right: 3%; height: auto;" %>
                                            </div>
                                            <div class="col s6 center-align" style="height: 65px; color: white;"><span style="font-size: 1.5em; text-overflow: ellipsis; color: #f5f5f5; position: relative; top: 25%; font-weight: 400;" ><%= current_user.display_name %></span></div>
                                            <div class="col s3 center-align" style="height: 65px; color: white;">
                                                <span style="color: gold; position: relative; top: 10%; line-height: 2.4em; font-weight: 300; font-size: 1.3em;">âœ¦ <%= x["character_stats"]["light_level"] %> </span>
                                                <span style="font-weight: 300; font-size: 1.1em;"><%= character_races[x["character_type"]] %></span>
                                            </div>
                                        </div>
                                        <div class="post-subheader" style="position: relative;height: 18px;bottom: 20px;">
                                            <div>
                                                <div class="row hide-on-med-and-up">
                                                    <div class="col s4 center-align" style="white-space: nowrap;">
                                                        <% if x["character_stats"]["ELO"]["ELO"].to_i >= 1700 %>
                                                            <% elo = "<span class='tooltip' data-tooltip-content='#diamond_elo_content' style='color:#7198B7;'> <b>#{x["character_stats"]['ELO']['ELO']}</b></span> " %>
                                                        <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1700 && x["character_stats"]["ELO"]["ELO"].to_i >= 1500 %>
                                                            <% elo = "<span class='tooltip' data-tooltip-content='#platinum_elo_content' style='color:#58907E;'> <b>#{x["character_stats"]['ELO']['ELO']}</b></span> " %>
                                                        <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1500 && x["character_stats"]["ELO"]["ELO"].to_i >= 1300 %>
                                                            <% elo = "<span class='tooltip' data-tooltip-content='#gold_elo_content' style='color:#CCAE50;'> <b>#{x["character_stats"]['ELO']['ELO']}</b></span> " %>
                                                        <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1300 && x["character_stats"]["ELO"]["ELO"].to_i >= 1200 %>
                                                            <% elo = "<span class='tooltip' data-tooltip-content='#silver_elo_content'  style='color:#BFC4C2;'> <b>#{x["character_stats"]['ELO']['ELO']}</b></span> " %>
                                                        <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1200 %>
                                                            <% elo = "<span class='tooltip' data-tooltip-content='#bronze_elo_content' style='color:#AA885F;'> <b>#{x["character_stats"]['ELO']['ELO']}</b></span> " %>
                                                        <% end %>  
                                                        <span class="white-text" style="font-size: 13px; vertical-align: text-top;">ELO: <%= elo.html_safe %></span>
                                                    </div>
                                                    <div class="col s4 center-align" style="white-space: nowrap;">
                                                        <span class="white-text" style="font-size: 13px; vertical-align: text-top;">KD: <%= x["character_stats"]["kd_ratio"] %></span>
                                                    </div>
                                                    <div class="col s4 center-align" style="white-space: nowrap;">
                                                        <span class="white-text" style="font-size: 13px; vertical-align: text-top;">W/L: <%= x["character_stats"]["win_rate"] %>%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="post-subclass-header" style='<%= subclass %> center-align' >
                                            <div class="row">
                                                <div class="col s12 m4"></div>
                                                <div class="col s12 m4 center-align">
                                                    <span class="" style="color: white;"> <%= x["Character Items"]["Subclass"]["Item Name"]  %></span>                                                                                                                                    
                                                </div>
                                                <div class="col s12 m4"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col s12 m6 center-align hide-on-small-only" style="height: 103px;">
                                    <div class="row center-align" style="margin-top: 1.9%; margin-bottom: 0;"><!--OPEN GUN PICTURES ROW-->                                                                          
                                        <div class="col s3 weapon-container center-align">
                                            <img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Primary Weapon"]["Item Name"] %>" src=<%= x["Character Items"]["Primary Weapon"]["Item Icon"] %> alt=""><br>
                                            <span class="truncate" style="font-size: 0.8em;"><%= x["Character Items"]["Primary Weapon"]["Item Name"] %></span> 
                                        </div>
                                        <div class="col s3 weapon-container center-align">
                                            <img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Secondary Weapon"]["Item Name"] %>" src=<%= x["Character Items"]["Secondary Weapon"]["Item Icon"] %> alt=""><br>
                                            <span class="truncate" style="font-size: 0.8em;"><%= x["Character Items"]["Secondary Weapon"]["Item Name"] %></span> 
                                        </div>
                                        <div class="col s3 weapon-container center-align">
                                            <img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Heavy Weapon"]["Item Name"] %>" src=<%= x["Character Items"]["Heavy Weapon"]["Item Icon"] %> alt=""><br>
                                            <span class="truncate" style="font-size: 0.8em;"><%= x["Character Items"]["Heavy Weapon"]["Item Name"] %></span> 
                                        </div>
                                        <% x["Character Items"].each do |item| %>
                                            <% next if ["emblem_background", "emblem"].include?(item[0])  %>
                                            <% if item[1]["Item Tier"] == "Exotic" %>
                                                <% if ["Chest Armor", "Gauntlets", "Helmet", "Leg Armor"].include? (item[0])  %>
                                                    <div class="col s2 weapon-container center-align">
                                                        <img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= item[1]["Item Name"] %>" src=<%= item[1]["Item Icon"] %> alt=""><br>
                                                        <span class="truncate" style="font-size: 0.8em;"><%= item[1]["Item Name"] %></span> 
                                                    </div>
                                                    <% break %>                                                                                                                     
                                                <% end %>
                                            <% end %>
                                            <!-- <div class="col s2 weapon-container center-align"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Helmet"]["Item Name"] %>" src=<%= x["Character Items"]["Helmet"]["Item Icon"] %> alt=""></div> -->
                                        <% end %>
                                        <!-- <div class="col s3">PRIMARY</div>
                                        <div class="col s3">SECONDARY</div>
                                        <div class="col s3">HEAVY</div>
                                        <div class="col s3">HELMET</div> -->
                                    </div><!--CLOSE GUN PICTURES ROW-->
                                </div>
                                <div class="col s12 m2 center-align hide-on-small-only" style='<%= "#{bg} height: 104px; color: #f5f5f5;border-bottom: 1px gray solid; padding-top: 1.5%; background-repeat: no-repeat; background-size: cover; background-position-x: 17%;" %>'>
                                    <div class="col s12 m6 right-align hide-on-small-only" style="width: 65%">
                                            <% if x["character_stats"]["ELO"]["ELO"].to_i >= 1700 %>
                                                <% elo = "<span class='tooltip' data-tooltip-content='#diamond_elo_content' style='color:#7198B7;'><b>#{x["character_stats"]['ELO']['ELO']}</b></span>" %>
                                            <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1700 && x["character_stats"]["ELO"]["ELO"].to_i >= 1500 %>
                                                <% elo = "<span class='tooltip' data-tooltip-content='#platinum_elo_content' style='color:#58907E;'><b>#{x["character_stats"]['ELO']['ELO']}</b></span>" %>
                                            <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1500 && x["character_stats"]["ELO"]["ELO"].to_i >= 1300 %>
                                                <% elo = "<span class='tooltip' data-tooltip-content='#gold_elo_content' style='color:#CCAE50;'><b>#{x["character_stats"]['ELO']['ELO']}</b></span>" %>
                                            <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1300 && x["character_stats"]["ELO"]["ELO"].to_i >= 1200 %>
                                                <% elo = "<span class='tooltip' data-tooltip-content='#silver_elo_content'  style='color:#BFC4C2;'><b>#{x["character_stats"]['ELO']['ELO']}</b></span>" %>
                                            <% elsif x["character_stats"]["ELO"]["ELO"].to_i < 1200 %>
                                                <% elo = "<span class='tooltip' data-tooltip-content='#bronze_elo_content' style='color:#AA885F;'><b>#{x["character_stats"]['ELO']['ELO']}</b></span>" %>
                                            <% end %> 

                                            <span  style="font-size: 16px;"><%= elo.html_safe %> ELO</span><br>
                                            <span  style="font-size: 18px;"><b><%= x["character_stats"]["kd_ratio"] %> </b>K/D</span><br>                                                                                                   
                                    </div>
                                    <div class="col s12 m6 right-align hide-on-small-only" style="width: 35%;">
                                        <span ><i id='<%= "collapse-icon-#{index}" %>'class="material-icons left more" style="color: #f5f5f5; font-size: 48px;">keyboard_arrow_down</i></span> 
                                        <span ><i id='<%= "collapse-icon-#{index}" %>'class="material-icons left less" style="color: #f5f5f5; font-size: 48px; display: none">keyboard_arrow_up</i></span>                                                            
                                    </div>
                                </div>                                
                            </div>
                        </div>            
                        <div class="collapsible-body" style="background: #fff;">
                            <div class="row">                                
                                <div class="col s12 m3 center-align">                                            
                                    <div class='<%="chart-container#{index + 1}" %>' data-chart-data="<%= character.to_json %>"></div>
                                    <div><canvas id='<%= "weapon-breakdown-chart#{index + 1}" %>' style="max-width: 275px !important; max-height: 275px !important"></canvas></div>                    
                                </div>
                                <hr class="hide-on-med-and-up">
                                <div class="col s12 m6 center-align">                                                                        
                                    <div><canvas id='<%= "kill-chart-breakdown#{index + 1}" %>'></canvas></div>                    
                                </div>
                                <hr class="hide-on-med-and-up">
                                <div class="col s12 m3 center-align" >             
                                        <div class="col s6" style="margin-top: 2%;">
                                            <div style="margin-bottom: -30%;"><canvas id='<%= "ability-chart-breakdown#{index + 1}" %>' style="max-width: 150px !important; max-height: 150px !important"></canvas></div> 
                                            <br><p class="stat-heading"><%= "#{x["character_stats"]["win_rate"]}%" %></p>       
                                        </div>                                        
                                        <div class="col s6" style="margin-top: 2%;">
                                            <div style="margin-bottom: -30%;"><canvas id='<%= "revive-chart-breakdown#{index + 1}" %>' style="max-width: 150px !important; max-height: 150px !important"></canvas></div>        
                                            <% total = x["character_stats"]["kill_stats"]["revives_performed"].to_i + x["character_stats"]["kill_stats"]["revives_received"].to_i %>
                                            <% res_percent = (x["character_stats"]["kill_stats"]['Revives Performed'].to_i / total.to_i) * 100.0 %>
                                            <br><p class="stat-heading"><%= "#{x["character_stats"]["kill_stats"]['Revives Performed'].to_i / total}%" %></p> 
                                        </div>                                        
                                        <div class="col s12">
                                            <!-- <table class="centered responsive-table">
                                                <thead>
                                                    <tr>
                                                        <th>Best Weapon</th>
                                                        <th>Longest Spree</th>
                                                        <th>Avg. Kill Distance</th>
                                                    </tr>
                                                </thead>
                                        
                                                <tbody>
                                                    <tr>
                                                        <td><%= image_tag "primary-weapon.png", style: "height: 16px;"  %></td>
                                                        <td style="font-size: 1.0em; font-weight: 600;">9</td>
                                                        <td style="font-size: 1.0em; font-weight: 600;">17.6</td>
                                                    </tr>                                                        
                                                </tbody>
                                            </table>     -->
                                            <p class="stat-heading">PLAYER ANALYSIS</p>
                                            <div class="col s6" style="color:red;">badge</div>
                                            <div class="col s6" style="color:red;">badge</div>
                                            <div class="col s6" style="color:red;">badge</div>
                                            <div class="col s6" style="color:red;">badge</div>
                                        </div>                                        
                                </div>                                    
                            </div>
                            <hr>
                            <div class="row" style="padding-top: 1%;margin-bottom: 0%;">
                                 <div class="col s6 m2 center-align">
                                    <p class="stat-heading">KA/D Ratio</p>
                                    <p class="stat-title"><%=x["character_stats"]["kad_ratio"] %></p>
                                 </div>
                                 <div class="col s6 m2 center-align">
                                    <p class="stat-heading">Games Played</p>
                                    <p class="stat-title"><%= (x["character_stats"]["games_won"] + x["character_stats"]["games_lost"]).round %></p>
                                 </div>
                                 <div class="col s12 m4 center-align">
                                    <p class="stat-heading">Best Weapon</p>
                                    <p class="stat-title"><%= image_tag weapons[x["character_stats"]["kill_stats"]["Best Weapon Type"]], style: "height: 35px;"  %></p>
                                 </div>
                                 <div class="col s6 m2 center-align">
                                    <p class="stat-heading">Longest Spree</p>
                                    <p class="stat-title"><%=x["character_stats"]["kill_stats"]["Longest Spree"].round %></p>
                                 </div>
                                 <div class="col s6 m2 center-align">
                                    <p class="stat-heading">Avg. Kill Distance</p>
                                    <p class="stat-title"><%=x["character_stats"]["kill_stats"]["Average Kill Distance"] %></p>
                                 </div>  
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col s12">
                                    <h5>Account Badges</h5>
                                    <% if !current_user.nil? %>
                                        <% current_user.badges.each do |badge| %>                
                                            <div class="chip tooltipped" style='<%= badge.custom_fields[:color] %>'data-position="top" data-delay="50" data-tooltip="<%= badge.description %>">
                                                <%= badge.name %>
                                                <%= badge.custom_fields[:icon].html_safe %>
                                            </div>                
                                        <% end %>
                                    <% end %>
                                </div>
                            </div>
                        </div>
                    </li>            
                <% end %>
            </ul>
        </div>
    </div>
</div>



<% characters = get_characters(current_user)%>
<% pve_options = ["D2 - Any", "D2 - Story", "D2 - Strikes", "Nightfall", "Wrath of the Machine", "King's Fall", "Crota's End", "Vault of Glass", "Challenge of the Elders", "Heroic Strikes", "Story", "Other"] %>
<% pvp_options = ["D2 - Any", "Trials of Osiris", "Iron Banner", "Crucible Playlist", "Other"] %>


<div class="col s12">
    <ul class="tabs tabs-fixed-width post-form-tabs" style="background-color: #5085a5; width: 107%; margin: -3.5%;" >
        <li class="tab col s6"><a href="#pve" class="post-form-tabs active">PVE</a></li>
        <li class="tab col s6"><a href="#pvp" class="post-form-tabs">PVP</a></li>
    </ul>
</div>
<div id="pvp">

    <div class="row">
        <%= form_for Micropost.new, :html => {:class => "col s12"}, remote: true do |f| %>
            <div class="row">
                <div class="input-field col s12">
                    <label class="gametype-label" style="top: -25px;">Gametype</label>
                    <%= f.select :game_type, pvp_options, {}, {id: "pvp-game-select" } %>
                </div>
            </div>

            <div class="row">
                <div class="input-field col s12 m5">
                    <label class="character-label" style="top: -25px;">Character</label>
                    <%= f.select :character_choice, characters, {}, {id: "character_choice" } %>
                </div>
                                
                <div class="input-field col s12 m5">
                    <label class="looking_for_label" style="top: -25px;">Looking for...</label>
                    <%= f.select :looking_for, ["Any", "Sherpa", "Sherpee", "Similar"], {}, {id: "looking_for" } %>
                </div>

                <div class="col s12 m2 center-align">               
                    <label class="pvp-mic-label" style="top: -25px;"><i class="fa fa-microphone" aria-hidden="true"></i> Have Mic?</label>  <div style="padding: 2%;"></div>       
                    <%= f.check_box :mic_required, id:"pvp_mic_required" %>
                    <%= f.label " ", for:"pvp_mic_required", id:"pvp_mic_required" %>                         
                </div>
            </div>

            <div class="row">
                <div class="row">
                
                    <div class="input-field col s12">
                        <i class="material-icons prefix">mode_edit</i>
                        <%= f.text_area :content, class: "materialize-textarea no-padding", id: "icon_prefix2", placeholder: "Message...", "data-length" => '50' %>
                    </div>
                </div>
            </div>

            <%= f.submit "Post", {class: "btn waves-effect waves-light", id: "post-submit"}  %>
        <% end %>
    </div>
    <hr>
</div>
<div id="pve">

    <div class="row">
        <%= form_for Micropost.new, :html => {:class => "col s12"}, remote: true do |f| %>
            <div class="row">
                <div class="input-field col s12" id="pve-gametype-select">
                    <label class="gametype-label" style="top: -25px;">Gametype</label>
                    <%= f.select :game_type, pve_options, {}, {id: "pve-game-select" } %>
                </div>
                <div class="col s12 m6 center-align">
                    <label class="difficulty-label" style="top: -25px;">Difficulty</label>
                    <div class="switch" id="difficulty">
                        <label style="color: #212155;">
                            Normal
                            <input type="checkbox" class="checkbox" value="Normal" name="micropost[raid_difficulty]" id="micropost_raid_difficulty">
                            <span class="lever"></span>
                            Heroic
                        </label>
                    </div>
                </div>

            </div>

            <div id="checkpoint">
                <div class="row">
                    <div class="col s12 left-align">
                        <label style="top: -25px;">Checkpoint</label>
                        <%= f.select :checkpoint, ["Coming Soon!"], {}, { disabled: true} %>
                    </div>
                </div>
            </div>
            

            <div class="row">
                <div class="input-field col s12 m5">
                    <label class="character-label" style="top: -25px;">Character</label>
                    <%= f.select :character_choice, characters, {}, {id: "character_choice" } %>
                </div>
                <div class="input-field col s12 m5">
                    <label class="mic-label" style="top: -25px;">Looking for...</label>
                    <%= f.select :looking_for, ["Any", "Sherpa", "Sherpee", "Similar"], {}, {id: "looking_for" } %>
                </div>

                <div class="col s12 m2 center-align">               
                    <label class="pve-mic-label" style="top: -25px;"><i class="fa fa-microphone" aria-hidden="true"></i> Have Mic?</label>  <div style="padding: 2%;"></div>       
                    <%= f.check_box :mic_required, id:"pve_mic_required" %>
                    <%= f.label " ", for:"pve_mic_required", id:"pve_mic_required" %>                         
                </div>
            </div>

            <div class="row">
                <div class="row">

                    <div class="input-field col s12 m12">
                        <i class="material-icons prefix">mode_edit</i>
                        <%= f.text_area :content, class: "materialize-textarea no-padding", id: "icon_prefix2", placeholder: "Message...", "data-length" => '50' %>
                    </div>
                </div>
            </div>
            <%= f.submit "Post", {class: "btn waves-effect waves-light", id: "post-submit"} %>
        <% end %>
    </div>
    <hr>
</div>


    






<code>
    <pre><%= JSON.pretty_generate(info) %></pre>    
</code>